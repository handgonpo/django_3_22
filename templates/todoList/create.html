{% extends "base.html" %} <!-- base.htmlì„ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ ì‚¬ìš© -->
{% load static %} <!-- ì •ì  íŒŒì¼(static) ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ í•„ìš”í•œ íƒœê·¸ -->

{% block content %}
    <!-- ì „ì²´ form êµ¬ì¡°ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ -->
    <div class="container todo600">
        <h2 class="h2_create">Create a New Todo</h2>
            
            {% csrf_token %} <!-- Django ë³´ì•ˆì„ ìœ„í•œ CSRF í† í° (form íƒœê·¸ ì—†ì§€ë§Œ ë¶™ì—¬ë„ ê´œì°®ìŒ) -->
            
            <!-- Todo ì´ë¦„ ì…ë ¥ -->
            <div>
                <label for="name">Name:</label>
                <input type="text" name="name" id="name">
            </div>

            <!-- ìƒì„¸ ì„¤ëª… ì…ë ¥ (ì—¬ê¸°ì— CKEditor ì ìš©ë¨) -->
            <div>
                <label for="description">Description:</label>
                <textarea name="description" id="description"></textarea>
            </div>

            <!-- ì™„ë£Œ ì—¬ë¶€ ì²´í¬ë°•ìŠ¤ -->
            <div>
                <label for="complete">Complete:</label>
                <input type="checkbox" name="complete" id="complete">
            </div>

            <!-- ê²½í—˜ì¹˜ ì…ë ¥ -->
            <div>
                <label for="exp">Experience Points:</label>
                <input type="number" name="exp" id="exp" min="0">
            </div>

            <!-- ìƒì„± ë²„íŠ¼ -->
            <button class="todoCreate" type="submit" id="todoCreate">Create</button>
    </div>
{% endblock %}

{% block extra_script %}
    <!-- ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ -->
    <script>
        
        /**
         * CSRF í† í°ì„ ì¿ í‚¤ì—ì„œ êº¼ë‚´ì˜¤ëŠ” í•¨ìˆ˜
         * Djangoì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ POST ìš”ì²­ ì‹œ CSRF í† í°ì„ í•¨ê»˜ ë³´ë‚´ì•¼ í•¨
         * ì´ í•¨ìˆ˜ëŠ” ë¸Œë¼ìš°ì € ì¿ í‚¤ì—ì„œ csrftoken ê°’ì„ ì°¾ì•„ ë°˜í™˜í•¨
        */
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        // ìœ„ í•¨ìˆ˜ í˜¸ì¶œí•´ì„œ csrftoken ë³€ìˆ˜ì— ì €ì¥
        const csrftoken = getCookie('csrftoken');  // csrftoken ê°€ì ¸ì˜¤ê¸°
    
        // CKEditor ì ìš©í•˜ê¸°
        // id="description"ì¸ textareaë¥¼ Rich Text ì—ë””í„°ë¡œ ë°”ê¿”ì¤Œ
        CKEDITOR.replace('description');
    
        /**
         * ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸: 'Create' ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰ë¨
         * - ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‚´ìš©ì„ axiosë¡œ ì„œë²„ì— POST ì „ì†¡
        */
        $("#todoCreate").on("click", function () {
            //console.log("ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆì–´ìš”.");
            
            // exp ê°’ì´ ë¹„ì–´ ìˆìœ¼ë©´ ê¸°ë³¸ê°’ 0ìœ¼ë¡œ ì„¤ì •
            let exp = $("#exp").val();
            if (exp === "") {
                exp = 0;
            }
    
            // CKEditorì—ì„œ ì…ë ¥í•œ description ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            let description = CKEDITOR.instances['description'].getData();
    
            // Axiosë¡œ POST ìš”ì²­ ë³´ë‚´ê¸°
            axiosInstance.post("/api/viewsets/todos/", { //insomnia ê²½ë¡œ
                name: $("#name").val(),
                description: description,
                complete: $("#complete").prop("checked"),
                exp: exp
            }, {
                headers: {
                    "X-CSRFToken": csrftoken // Djangoê°€ ìš”êµ¬í•˜ëŠ” CSRF í—¤ë” ì¶”ê°€
                }
            })
            // ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ë©´ todo ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
            .then(function (response) {
                window.location.href = "/todoList/list/";
            })
            // ì‹¤íŒ¨í•˜ë©´ ì½˜ì†” ì¶œë ¥ + alert ë©”ì‹œì§€ ë„ìš°ê¸°
            .catch(function (error) {
                console.log(error);
                alert("Todo ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            });
        });
    </script>  
{% endblock %}
<!--  
ğŸ¯ ìš”ì•½ íë¦„
- ì‚¬ìš©ìê°€ ì…ë ¥ â†’ #todoCreate ë²„íŠ¼ í´ë¦­
- CKEditorì™€ ì…ë ¥ê°’ ìˆ˜ì§‘
- axios.post()ë¡œ /api/viewsets/todos/ ì£¼ì†Œì— ë°ì´í„° ì „ì†¡
- ì„±ê³µ ì‹œ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™, ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
-->
